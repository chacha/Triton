<!DOCTYPE HTML>
<html manifest="mf.php">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Triton</title>
        <link href="style.css" rel="stylesheet">
        <script src="lib.js"></script>
        <script src="jquery.js"></script>
        <script src="json.js"></script>
        <script src="autogrow.js"></script>
        <script src="hotkeys.js"></script>
        <script src="Thread.js"></script>
        <script src="ThreadEncoder.js"></script>
        <script src="ThreadIndex.js"></script>
        <script src="TritonSidebar.js"></script>
        <script src="TritonKUI.js"></script>
        <script src="TritonEditor.js"></script>
        <script src="ThreadManager.js"></script>
        <script src="ThreadSlider.js"></script>
    </head>
    <body>
        <div id="dev">
            <form>
            <input type="submit" id="dev-button">
            <input type="text" id="dev-box">
            </form>
        </div>
        <div id="wash">&nbsp;</div>
        <nav>
            <div id="advanced">
                <div id="documents">
                    <header>
                        Documents
                    </header>
                    <ul id="document-list">
                    </ul>
                </div>
            </div>
            <header>
                <a id="logo">Triton</a>
                <div class="meta">
                    v 0.1. &copy 2010 Tyler Carter
                </div>
            </header>
            <ul id="links">
            </ul>
            <div id="overview">
            </div>
        </nav>
        <div id="posts"></div>
        <pre id="object"></pre>
        <script>
            (function(){

                // Get the Thread
                var post_key = window.location.hash.substr(1);
                
                // Start up the editor
                var editor = TritonEditor(window);
                editor.init();
                var thread = editor.current();
                var encoder = editor.getEncoder();
                var index = editor.getIndex();
                var manager = editor.getManager();

                var $t = function(message){

                    var commands = {
                        "reload" : function(){
                            location.reload(true);
                        },
                        "redraw" : function(){
                            editor.draw();
                        },
                        "create post" : function(){
                            editor.createPost();
                        },
                        "create doc" : function(){
                            var thread = manager.createThread("Test");
                            thread.createPost("test");
                            location.hash = thread.getID();
                            editor.loadThread(location.hash.substr(1));
                            editor.draw();
                        },
                        "delete doc" : function(){
                            index.deleteIndex(thread.getID())
                        },
                        "delete docs" : function(){
                            index.deleteAll();
                        }
                    }

                    if(arguments.length > 1){

                        var len = arguments.length;
                        for(var i=0; i < len; i++){
                            $t(arguments[i])
                        }

                        console.log(len + " commands executed.");
                    }else{
                        if(typeof commands[message] == "function"){
                            console.log(message);
                            commands[message]();
                            return true;
                        }else{
                            return false;
                        }
                    }                    
                }
                window.$t = $t;

                $("#dev-button").click(function(){
                    var text = $("#dev-box").val();
                    var commands = text.split(",");
                    $t.apply(null, commands);
                    $("#dev-box").val("");
                    return false;
                })

                // Special Case Items
                $("#delete_all").click(function(){
                    $t("delete docs");
                });

                $("#create_new").click(function(){
                   $t("create post");
                });

                var createDoc = function(){
                    $t("create doc");
                    $(this).click(createDoc);
                };
                $("#new_doc").click(createDoc);
                $("#new_doc").click(function(){console.log("X")});

                $("#delete_doc").click(function(){
                    $t("delete doc");
                    return false;
                });

                


                var openNav = function(){
                    $("nav").animate({"right": "0px"});
                    $("#wash").show()
                    $("#logo").unbind("click");
                    $("#logo").click(closeNav);
                    $("#wash").click(closeNav);
                }

                var closeNav = function(){
                    $("nav").animate({"right": "-320px"});
                    $("#wash").hide()
                    $("#logo").unbind("click");
                    $("#logo").click(openNav);
                }
                $("#logo").click(openNav);

                if(editor.current() == false){
                    $("#logo").click();
                }
                   
                
                
            })();

        </script>
    </body>
</html>
