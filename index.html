<!DOCTYPE HTML>
<html manifest="etc/mf.php">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Triton</title>
        <link href="css/style.css" rel="stylesheet">
        <script src="js/lib.js"></script>
        <script src="js/jquery.js"></script>
        <script src="js/json.js"></script>
        <script src="js/autogrow.js"></script>
        <script src="js/hotkeys.js"></script>
        <script src="js/Triton.js"></script>
        <script src="js/Thread.js"></script>
        <script src="js/ThreadEncoder.js"></script>
        <script src="js/ThreadIndex.js"></script>
        <script src="js/TritonSidebar.js"></script>
        <script src="js/TritonKUI.js"></script>
        <script src="js/TritonEditor.js"></script>
        <script src="js/TritonPosts.js"></script>
        <script src="js/ThreadManager.js"></script>
        <script src="js/ThreadSlider.js"></script>
        <script src="js/TritonKeywords.js"></script>
    </head>
    <body>
        <div id="dev">
            <form>
            <input type="submit" id="dev-button">
            <input type="text" id="dev-box">
            </form>
        </div>
        <div id="wash">&nbsp;</div>
        <nav>
            <div id="advanced">
                <div id="documents">
                    <header>
                        Documents
                    </header>
                    <ul id="document-list">
                    </ul>
                </div>
            </div>
            <header>
                <a id="logo">Triton</a>
                <div class="meta">
                    v 0.1. &copy 2010 Tyler Carter
                </div>
            </header>
            <ul id="links">
            </ul>
            <div id="overview">
            </div>
        </nav>
        <div id="posts"></div>
        <pre id="object"></pre>
        <script>
            (function(){
                
                // Start the editor
                var editor = window.Triton.TritonEditor(window);
                editor.init();
                var thread = editor.current();
                var encoder = editor.getEncoder();
                var index = editor.getIndex();
                var manager = editor.getManager();

                var $t = function(message){

                    var commands = {
                        "reload" : function(){
                            location.reload(true);
                        },
                        "redraw" : function(){
                            editor.draw();
                        },
                        "create post" : function(){
                            $('textarea').blur();
                            var id = editor.current().createPost("");

                            // Display the box and focus it
                            editor.draw();
                            $("#" + id).click();

                        },
                        "create doc" : function(){
                            var thread = manager.createThread("Test");
                            thread.createPost("test");
                            location.hash = thread.getID();
                            editor.loadThread(location.hash.substr(1));
                            editor.draw();
                        },
                        "delete doc" : function(){
                            
                            // Delete the Post
                            index.deleteIndex(editor.current().getID())

                            // Move back a post
                            var threads = index.getIndex();

                            if(threads.length > 0){
                                var last = threads[threads.length - 1].id;
                                location.hash = last;
                                editor.loadThread(last);
                                editor.draw();
                            }else{
                                location.hash = "";
                                editor.clearThread();
                                editor.draw();
                            }
                        },
                        "delete docs" : function(){
                            index.deleteAll();
                        }
                    }

                    if(arguments.length > 1){

                        var len = arguments.length;
                        for(var i=0; i < len; i++){
                            $t(arguments[i])
                        }

                        console.log(len + " commands executed.");
                    }else{
                        if(typeof commands[message] == "function"){
                            console.log(message);
                            commands[message]();
                            return true;
                        }else{
                            return false;
                        }
                    }                    
                }
                window.$t = $t;

                $("#dev-button").click(function(){
                    var text = $("#dev-box").val();
                    var commands = text.split(",");
                    $t.apply(null, commands);
                    $("#dev-box").val("");
                    return false;
                })

            })();

        </script>
    </body>
</html>
